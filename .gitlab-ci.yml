# This file was autogenerated by 10up Toolkit.

image: docker.10up.com/10up-build/deploy-container:latest

include:
  - project: 10up-build/ci-library
    ref: trunk
    file: /main.yml

test_syntax:
  stage: test
  script:
    - php-syntax
  dependencies: []
  cache: {}

test_virusscan:
  stage: test
  script:
    - virus-scan
  dependencies: []
  cache: {}

build_plugins_and_themes:
  stage: build
  script:
    - nvm install 18
    - npx 10up-toolkit project build --type=full
  artifacts:
    paths:
      - payload
    expire_in: 1 day
  cache: {}

deploy_production:
  stage: deploy
  extends: .wordpress-deploy-rsync
  environment:
    name: Production
    url: https://example.com
  variables:
    DESTINATION: user@1.1.1.1/path/to/wordpress/
    SUBDIR: wp-content/
    EXCLUDES: ./scripts/rsync-excludes.txt
  only:
    refs:
      - trunk

deploy_staging:
  stage: deploy
  extends: .wordpress-deploy-rsync
  environment:
    name: staging
    url: https://staging.example.com
  variables:
    DESTINATION: user@1.1.1.1/path/to/wordpress/
    SUBDIR: wp-content/
    EXCLUDES: ./scripts/rsync-excludes.txt
  only:
    refs:
      - staging
